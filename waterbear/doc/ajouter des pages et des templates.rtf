{\rtf1\ansi\ansicpg1252\uc1\deff0\stshfdbch0\stshfloch0\stshfhich0\stshfbi0\deflang1036\deflangfe1036{\fonttbl{\f0\froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f1\fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Arial;}
{\f3\froman\fcharset2\fprq2{\*\panose 05050102010706020507}Symbol;}{\f37\froman\fcharset238\fprq2 Times New Roman CE;}{\f38\froman\fcharset204\fprq2 Times New Roman Cyr;}{\f40\froman\fcharset161\fprq2 Times New Roman Greek;}
{\f41\froman\fcharset162\fprq2 Times New Roman Tur;}{\f42\froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\f43\froman\fcharset178\fprq2 Times New Roman (Arabic);}{\f44\froman\fcharset186\fprq2 Times New Roman Baltic;}
{\f45\froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\f47\fswiss\fcharset238\fprq2 Arial CE;}{\f48\fswiss\fcharset204\fprq2 Arial Cyr;}{\f50\fswiss\fcharset161\fprq2 Arial Greek;}{\f51\fswiss\fcharset162\fprq2 Arial Tur;}
{\f52\fswiss\fcharset177\fprq2 Arial (Hebrew);}{\f53\fswiss\fcharset178\fprq2 Arial (Arabic);}{\f54\fswiss\fcharset186\fprq2 Arial Baltic;}{\f55\fswiss\fcharset163\fprq2 Arial (Vietnamese);}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;
\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;
\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}{\stylesheet{\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 \snext0 Normal;}{\*\cs10 \additive 
\ssemihidden Default Paragraph Font;}{\*\ts11\tsrowd\trftsWidthB3\trpaddl108\trpaddr108\trpaddfl3\trpaddft3\trpaddfb3\trpaddfr3\trcbpat1\trcfpat1\tscellwidthfts0\tsvertalt\tsbrdrt\tsbrdrl\tsbrdrb\tsbrdrr\tsbrdrdgl\tsbrdrdgr\tsbrdrh\tsbrdrv 
\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \fs20\lang1024\langfe1024\cgrid\langnp1024\langfenp1024 \snext11 \ssemihidden Normal Table;}}{\*\latentstyles\lsdstimax156\lsdlockeddef0}{\*\listtable{\list\listtemplateid1764816928
\listsimple{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat0\levelspace0\levelindent0{\leveltext\'01*;}{\levelnumbers;}}{\listname ;}\listid-2}}{\*\listoverridetable{\listoverride\listid-2\listoverridecount1{\lfolevel
\listoverrideformat{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat0\levelold\levelspace0\levelindent0{\leveltext\'01\u-3913 ?;}{\levelnumbers;}\f3\fbias0 }}\ls1}}{\*\rsidtbl \rsid6309316}{\*\generator Microsoft Word 11.
0.6568;}{\info{\author 020529N}{\operator 020529N}{\creatim\yr2014\mo9\dy17\hr11\min38}{\revtim\yr2014\mo9\dy17\hr11\min51}{\version2}{\edmins13}{\nofpages4}{\nofwords1382}{\nofchars7604}{\*\company DINT}{\nofcharsws8969}{\vern24579}}
\margl1417\margr1417\margt1417\margb1417 \widowctrl\ftnbj\aenddoc\hyphhotz425\noxlattoyen\expshrtn\noultrlspc\dntblnsbdb\nospaceforul\hyphcaps0\horzdoc\dghspace120\dgvspace120\dghorigin1701\dgvorigin1984\dghshow0\dgvshow3
\jcompress\viewkind4\viewscale100\nolnhtadjtbl\rsidroot6309316 \fet0\sectd \linex0\sectdefaultcl\sftnbj {\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl3
\pndec\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang {\pntxta )}}{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}
{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}\pard\plain 
\qc \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\b\f1\fs28\insrsid6309316 AJOUTER DES PAGES ET DES TEMPLATES}{\f1\fs28\insrsid6309316 
\par 
\par }{\f1\fs20\insrsid6309316 
\par }\pard \ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 {\f1\fs20\insrsid6309316 
\par }{\b\f1\ul\insrsid6309316 I Cr\'e9er une nouvelle page}{\f1\fs20\insrsid6309316 
\par 
\par }{\b\f1\fs20\ul\insrsid6309316 1) D\'e9clarer la nouvelle page dans le registre}{\f1\fs20\insrsid6309316 
\par 
\par {\pntext\pard\plain\f3\fs20 \loch\af3\dbch\af0\hich\f3 \'b7\tab}}\pard \ql \fi-720\li720\ri0\nowidctlpar{\*\pn \pnlvlblt\ilvl0\ls1\pnrnot0\pnf3 {\pntxtb \'b7}}\faauto\ls1\rin0\lin720\itap0\pararsid6309316 {\f1\fs20\insrsid6309316 D\'e9
clarer la nouvelle page dans profiles/defaut/pages\line 
\par {\pntext\pard\plain\f3\fs20 \loch\af3\dbch\af0\hich\f3 \'b7\tab}La page  est li\'e9e \'e0 une arborescence (on pourra par exemple cr\'e9er la page profiles/defaut/pages/bib/catalogue/imports/choix qui correspond \'e0 la page bib/catalogue/imports/choix)
\line 
\par }\pard \ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 {\f1\fs20\insrsid6309316 Chaque page contient 4 rubriques principales :\line 1. }{\b\f1\fs20\insrsid6309316 _droits }{\f1\fs20\insrsid6309316 : les droits d'acc\'e8s \'e0 la page\line 2. }{
\b\f1\fs20\insrsid6309316 _page }{\f1\fs20\insrsid6309316 : le script PHP \'e0 appeler\line 3. }{\b\f1\fs20\insrsid6309316 _template }{\f1\fs20\insrsid6309316 : les templates qui seront utilis\'e9s par le script en question\line 4. }{
\b\f1\fs20\insrsid6309316 _parametres }{\f1\fs20\insrsid6309316 : les param\'e8tres qui pourront \'eatre pass\'e9s au script et aux templates\line 
\par }{\b\f1\fs20\ul\insrsid6309316 2) Tirer parti de l'h\'e9ritage}{\b\f1\fs20\insrsid6309316 
\par }{\f1\fs20\insrsid6309316 
\par Pour chacune de ces rubriques (sauf _page), WaterBear tire parti de l'h\'e9ritage. C'est \'e0 dire qu'une information d\'e9finie \'e0 un niveau de l'arborescence sera valable pour tous ses descendants. Inversement, une information d\'e9
finie au niveau de l'enfant \'e9crasera celle d\'e9finie au niveau du parent.
\par 
\par Attention, ce m\'e9canisme de fusion ne marche qu'au premier niveau
\par Par exemple si on a d\'e9fini :
\par profiles/defaut/pages/bib/admin/_parametres/V1 = toto
\par profiles/defaut/pages/bib/admin/objets/_parametres/V2 = tutu
\par alors les valeur V1 et V2 seront d\'e9finies au niveau de profiles/defaut/pages/bib/admin/objets
\par En revanche, si on on d\'e9finit
\par profiles/defaut/pages/bib/admin/_parametres/V1/V2 = tutu
\par profiles/defaut/pages/bib/admin/objets/_parametres/V1/V3 = tutu
\par alors l'ancienne valeur V1/V2 (toto) sera \'e9cras\'e9e
\par 
\par }{\b\f1\fs20\insrsid6309316 Exemple 1}{\f1\fs20\insrsid6309316  : On peut ne d\'e9clarer qu'une seule fois le "template squelette" pour toutes les pages de l'administration, car le squelette est le m\'eame pour toutes ces pages. On d\'e9clarera donc :

\par profiles/defaut/pages/bib/admin/_template/tmpl_squelette = bib/admin.php
\par 
\par Cette d\'e9claration sera valable pour toutes les pages enfants de ce noeud. N\'e9anmoins, si un des enfants souhaitait utiliser un autres squelette, il pourrait red\'e9clarer /_template/tmpl_squelette 
\par 
\par }{\b\f1\fs20\insrsid6309316 Exemple 2}{\f1\fs20\insrsid6309316  : De la m\'eame mani\'e8re, au niveau des param\'e8tres, on pourra d\'e9clarer les \'e9l\'e9ments d'une barre d'outils qui sera pr\'e9
sente sur plusieurs pages, ou attribuer des droits pour toutes les pages de l'administration en ne faisant qu'une seule fois la d\'e9claration. Mais on a toujours la possibilit\'e9 de remplacer cette d\'e9claration au niveau des noeuds enfants.
\par 
\par }{\b\f1\fs20\insrsid6309316 Cas de _page}{\f1\fs20\insrsid6309316  : _page fonctionne diff\'e9remment, les diff\'e9rentes d\'e9clarations de _page se cumulent. Elles ne se remplacent pas.
\par Normalement quand on appelle une page, on ne devrait lancer qu'un seul script. N\'e9anmoins, il peut \'eatre utile de mutualiser une partie du code entre les diff\'e9rentes pages d'un m\'eame module. Par exemple pour d\'e9
finir des vraiables, faire des include...
\par 
\par Donc si on d\'e9finit _page \'e0 un niveau parent et \'e0 nouveau \'e0 un niveau enfant, les deux scripts seront appel\'e9s successivement.
\par 
\par }{\b\f1\fs20\ul\insrsid6309316 3) Cr\'e9er le script de page}{\f1\fs20\insrsid6309316 
\par 
\par Il suffit de cr\'e9er un script dans include/pages.
\par A la fin du script, il faut placer la ligne :
\par }{\b\f1\fs20\insrsid6309316 include ($GLOBALS["tvs_global"]["conf"]["ini"]["include_path"]."/scripts/affiche_page.php");
\par }{\f1\fs20\insrsid6309316 afin de pouvoir appeler les scripts suivants (d\'e9finis dans les enfants).
\par 
\par Il est n\'e9cessaire que le dernier script appel\'e9 affiche le template du squelette.
\par 
\par Lorsqu'un script n'a aucun traitement \'e0 effectuer, mais doit simplement appeler le template squelette, on peut appeler le script }{\b\f1\fs20\insrsid6309316 void.php }{\f1\fs20\insrsid6309316 
\par 
\par }{\b\f1\fs20\ul\insrsid6309316 4) Afficher les templates
\par }{\f1\fs20\insrsid6309316 
\par Dans le scripts, on peut acc\'e9der aux informations param\'e9tr\'e9es dans le registre via les variables globales :
\par }{\b\f1\fs20\insrsid6309316 $GLOBALS["affiche_page"]["parametres"] }{\f1\fs20\insrsid6309316 => pour les donn\'e9es d\'e9finies dans _parametres
\par }{\b\f1\fs20\insrsid6309316 $GLOBALS["affiche_page"]["template"] }{\f1\fs20\insrsid6309316 => pour les donn\'e9es d\'e9finies dans _template
\par 
\par Pour afficher un template, il suffit d'appeler la fonction :
\par }{\b\f1\fs20\insrsid6309316 affiche_template ($nom_du_template, $parametres);
\par }{\f1\fs20\insrsid6309316 > $nom_du_template est le chemin du fichier template \'e0 partir de la racine des templates (include/templates)
\par    Comme g\'e9n\'e9ralement les templates sont param\'e9tr\'e9s dans le registre, on aura souvent qqchse du genre 
\par    $GLOBALS["affiche_page"]["template"]["tmpl_barre_menus1"]
\par > $parametres : un tableau associatif permetta
nt de passer des variables au template. Les variables seront accessibles      directement par leur nom. Par exemple si on passe array("toto"=>"tutu") ou pourra faire dans le template print ($toto) et non pas print ($parametres["toto"])
\par 
\par }{\b\f1\fs20\ul\insrsid6309316 4) Les templates
\par }{\f1\fs20\insrsid6309316 
\par Le template est un fichier HTML, CSS ou javascript pouvant contenir des petits scripts PHP
\par 
\par Le template peut contenir d'autres templates
\par 
\par Il peut acc\'e9der directement aux variables transmises depuis la fonction affiche_template()
\par 
\par Il peut \'e9galement acc\'e9der aux varaibles globales (et en particulier \'e0 $GLOBALS["affiche_page"]["template"] pour int\'e9grer d'autres templates et $GLOBALS["affiche_page"]["parametres"] )
\par 
\par 
\par }{\b\f1\fs20\ul\insrsid6309316 5) Personnalisation}{\f1\fs20\insrsid6309316 
\par 
\par Il est possible de personnaliser les param\'e8tres d'une page en fonction de l'utilisateur ou du poste (ou du groupe d'utilisateurs ou du groupe de postes).
\par 
\par Pour cela, on peut placer un noeud }{\b\f1\fs20\insrsid6309316 _profiles }{\f1\fs20\insrsid6309316 dans le noeud _parametres.
\par Le noeud _profiles contiendra un sous-noeud pour chaque profile que l'on voudra d\'e9finir. On peut cr\'e9er des profiles li\'e9s aux utilisateurs et aux postes ou des profiles ind\'e9pendants (que l'on changera manuellement).
\par 
\par Un profile \'e0 la forme suivante : }{\b\f1\fs20\insrsid6309316 UTILISATEUR:POSTE }{\f1\fs20\insrsid6309316 sachant que ces deux \'e9l\'e9ments peuvent d\'e9crire soit un utilisateur ou un poste particulier, soit des groupes. Dans le pemier cas, on pr\'e9
fixe par "P", dans le deuxi\'e8me par "G".
\par Ainsi : 
\par Ptoto:Gtutu d\'e9signe l'utilisateur toto sur un poste du groupe tutu
\par Gtata:Gtutu : un utilisateur du groupe tata sur un poste du groupe tutu
\par Ptoto:Ptiti : l'utilisateur toto sur le poste titi
\par Ptoto:* : l'utilisateur toto sur n'importe quel poste
\par 
\par Par ailleurs, on peut d\'e9finir des profiles libres, qui pourront \'eatre appliqu\'e9s manuellement.
\par 
\par Il y a une hi\'e9rarchie des profiles. En gros, du plus particulier au plus large. Ainsi, pour un m\'eame noeud, on pourra d\'e9finir un profil pour un groupe d'utilisateurs et un autre pour un utilisateur particulier du m\'ea
me groupe : c'est ce dernier qui sera utilis\'e9. Dans l'ordre (du moins prioritaire au plus prioritaire) :
\par }{\f1\fs20\insrsid6309316 *:*, }{\f1\fs20\insrsid6309316 *:G$Gposte, G$Guser:*, G$Guser:G$Gposte, *:P$poste, P$user:*, G$Guser:P$poste, P$user:G$Gposte, P$user:P$poste
\par 
\par L'int\'e9rieur du noeud _profiles/XXXX/ est le m\'eame que celui du noeud _parametres. Cependant, il n'est pas n\'e9cessaire de d\'e9doubler totalement ces 2 noeuds. Leurs contenus seront fusionn\'e9s. On ne d\'e9
calrera donc dans le noeud du profile que les variables sp\'e9cifiques. Si la m\'eame variable est d\'e9finie dans _parametres et dans _profiles/XXX, c'est cette derni\'e8re qui l'emporte.
\par 
\par }{\b\f1\fs20\ul\insrsid6309316 6) Les droits
\par 
\par }{\f1\fs20\insrsid6309316 Il est possible d'autoriser l'acc\'e8s \'e0 certaines pages ou \'e0 certaines actions sur une page (ou un webService li\'e9 \'e0 une page), et ce pour certains utilisateurs, pour certains postes ou pour certains groupes.
\par 
\par Pour cela, il aut cr\'e9er un noeud _droits sous le noeud de la page. Le noeud _droits contiendra un sous noeud pour chaque profile. Ces profiles ont la m\'eame syntaxe que pour la personnalisation. Par exemple, Ptoto:Gtutu d\'e9signera des droits assign
\'e9s \'e0 l'utilisateur toto sur les postes du groupe tutu.
\par 
\par }{\b\f1\fs20\insrsid6309316 Les droits sur les pages}{\f1\fs20\insrsid6309316 
\par 
\par Pour assigner des droits sur une page, il suffit de donner la valeur 0 (interdit) ou 1 (autoris\'e9) au noeud du profil. Par exemple :
\par + _droits
\par \tab + *:* => 0
\par \tab + Ptutu:Gtoto => 1
\par 
\par signifie qu'on interdit l'acc\'e8s \'e0 tout le monde, sauf \'e0 l'utilisateur tutu quand il est sur un poste du groupe toto
\par 
\par }{\b\f1\fs20\insrsid6309316 Les droits li\'e9s aux variables}{\f1\fs20\insrsid6309316 
\par 
\par On peut assigner des droits plus pr\'e9cis \'e0 l'int\'e9rieur d'une page, en fonction de la valeur prise par certaines variables. C'est surtout utile pour les pages de type WebService.
\par 
\par Par exemple, on peut autoriser l'acc\'e8s \'e0 une page, SAUF si la variable $operation == "modifier". Cela permet par exemple d'autoriser l'acc\'e8s en consultation, mais pas en modification...
\par ATTENTION 1 : Il ne s'afit que des varaibles pass\'e9es en param\'e8tre au script, (accessibles via la variable $_REQUEST)
\par ATTENTION 2 : Pour l'instant, on ne peut pas croiser les varaibles. Par exemple, on peut interdire l'acc\'e8s \'e0 une page si $operation == "modifier" }{\b\f1\fs20\insrsid6309316 ou}{\f1\fs20\insrsid6309316  $type == "CD", mais on ne peut pas l'interdir
e uniquement si les 2 conditions sont remplies.
\par 
\par Pour Interdire l'acc\'e8s \'e0 une page si la variable $operation == "toto", sauf si on se trouve sur e poste p123, il faut param\'e9trer le registre comme suit :
\par + _droits
\par      +}{\b\f1\fs20\insrsid6309316  _variables}{\f1\fs20\insrsid6309316 
\par           + operation -----------------> nom de la variable
\par                + toto --------------------> valeur de la variable
\par                     + *:* => 0 ---------> autorisation \'e0 attribuer pour chaque profile
\par                     + *:Pp123 => 1
\par 
\par }{\b\f1\fs20\insrsid6309316 H\'e9ritage et hi\'e9rarchie des droits}{\f1\fs20\insrsid6309316 
\par 
\par Il n'est pas n\'e9cessaire d'attribuer des droits \'e0 chaque page. WaterBear utilise l'h\'e9ritage des pages. Un droit attribu\'e9 au niveau du parent sera automatiquement propag\'e9 \'e0 tous ses enfants. En revanche, il peut \'eatre \'e9cras\'e9 (red
\'e9fini) au niveau d'un noeud enfant.
\par 
\par Par ailleurs, au niveau d'une page, les droits li\'e9s aux variables l'emportent sur les droits simplement li\'e9s \'e0 la page.
\par 
\par 
\par }}